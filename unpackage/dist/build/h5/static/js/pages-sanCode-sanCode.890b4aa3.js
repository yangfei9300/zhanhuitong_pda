(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["pages-sanCode-sanCode"],{1647:function(t,n,e){"use strict";e.r(n);var o=e("b01e"),i=e("f776");for(var s in i)"default"!==s&&function(t){e.d(n,t,(function(){return i[t]}))}(s);e("a173");var a,c=e("f0c5"),u=Object(c["a"])(i["default"],o["b"],o["c"],!1,null,"776b95b4",null,!1,o["a"],a);n["default"]=u.exports},a173:function(t,n,e){"use strict";var o=e("deb0"),i=e.n(o);i.a},b01e:function(t,n,e){"use strict";var o;e.d(n,"b",(function(){return i})),e.d(n,"c",(function(){return s})),e.d(n,"a",(function(){return o}));var i=function(){var t=this,n=t.$createElement,e=t._self._c||n;return e("v-uni-view",{staticClass:"colonn center_center"},[e("v-uni-view",{staticClass:"roww w-710 border_bottom",staticStyle:{padding:"20rpx 20rpx","font-size":"30rpx"}},[e("v-uni-view",[t._v("当前展会")]),e("v-uni-view",{staticClass:"allline"}),e("v-uni-view",{staticClass:"w-500 txtShowLength",staticStyle:{color:"#000000","text-align":"right"}},[t.exhInfo?[t._v(t._s(t.exhInfo[0]))]:[t._v("请选择展会")]],2)],1),e("v-uni-view",{staticClass:"roww w-710 border_bottom",staticStyle:{padding:"20rpx 20rpx","font-size":"30rpx"}},[e("v-uni-view",[t._v("当前状态")]),e("v-uni-view",{staticClass:"allline"}),e("v-uni-view",{staticClass:"w-500 txtShowLength",staticStyle:{color:"#000000","text-align":"right"}},[2==t.isLixian?[t._v("离线模式")]:[t._v("在线模式")]],2)],1),e("v-uni-view",{staticClass:"roww w-710 border_bottom",staticStyle:{padding:"20rpx 20rpx","font-size":"30rpx"}},[e("v-uni-view",[t._v("懒人模式（连续扫描）")]),e("v-uni-view",{staticClass:"allline"}),e("v-uni-view",{staticClass:"w-300 ",staticStyle:{color:"#000000","text-align":"right","font-weight":"bold"},on:{click:function(n){n.stopPropagation(),arguments[0]=n=t.$handleEvent(n),t.lianxuIsClick.apply(void 0,arguments)}}},[t._v(t._s(t.lianxuIs?"关闭":"开启"))])],1),e("v-uni-view",{staticClass:"btncen center_center colonn",staticStyle:{"margin-top":"40%"}},[e("v-uni-view",{staticClass:"colonn center_center",staticStyle:{color:"#ffffff","font-size":"40rpx","line-height":"30rpx","font-weight":"bold"}},[e("v-uni-view",[t._v("核销手机号")]),e("v-uni-view",{staticStyle:{color:"#ffffff","margin-top":"45rpx"}},[t._v(t._s(t.scanResult))])],1)],1),e("v-uni-view",{staticClass:"roww center_center width poab",staticStyle:{bottom:"40rpx"}},[e("v-uni-view",{staticClass:"w-50"}),e("v-uni-view",{staticStyle:{color:"#000000"}},[e("v-uni-view",{staticStyle:{color:"#000000"}},[t.exhInfo?[t._v(t._s(t.exhInfo[3]))]:[t._v("请选择门")]],2)],1),e("v-uni-view",{staticClass:"allline roww center_center"},[t.selResultCount?e("v-uni-view",[t._v("今天总人数："+t._s(t.selResultCount.count))]):e("v-uni-view",[t._v("数量统计未开放")])],1),e("v-uni-view",{staticStyle:{color:"#2E7EFC"},on:{click:function(n){n.stopPropagation(),arguments[0]=n=t.$handleEvent(n),t.toLogin.apply(void 0,arguments)}}},[t._v("退出登录")]),e("v-uni-view",{staticClass:"w-50"})],1)],1)},s=[]},b627:function(t,n,e){"use strict";var o=e("4ea4");e("99af"),e("c975"),e("e25e"),e("ac1f"),e("1276"),Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var i=o(e("f5e1")),s={data:function(){return{zhanhuiInfo:null,exhList:["展会1","展会2"],cishuNum:0,lianxu:!1,invTime:"1000",menType:null,menList:[],exhInfo:null,scanResult:"",isLixian:1,selResultCount:null,lianxuIs:!1}},onLoad:function(){var t=uni.getStorageSync("exhInfo");if(console.log("当前扫码信息",t),!t)return this.$tools.showToast("请扫展会二维码进行登录"),!1;var n=uni.getStorageSync("isLixian");n&&(this.isLixian=n),this.exhInfo=t,this.openSQL()},onShow:function(){var t=this;uni.$off("scan"),uni.$on("scan",(function(n){console.log("扫码界面监听结果",n),t.initScan(n.data)}))},onUnload:function(){var t=this;console.log("卸载"),getApp().globalData.barcodeModel.continueScan(!1,(function(n){t.lianxuIs=!1}))},methods:{lianxuIsClick:function(){var t=this;this.lianxuIs=!this.lianxuIs,getApp().globalData.barcodeModel.continueScan(this.lianxuIs,(function(n){t.lianxuIs?t.$tools.showToast("连续扫描开启成功"):t.$tools.showToast("连续扫描已关闭")}))},initScan:function(t){if(!this.exhInfo)return this.$tools.showToast("请先前往登录页面选择展会"),!1;var n=t.barcode;n.indexOf("-")>=0?this.hexiaoLuntan(n):this.$tools.isphone(n)?this.hexiao(n):this.$tools.showToast("请勿扫描其他码-----"+n)},continueScanFunc:function(t){var n=this;this.lianxu=t,t&&barcodeModel.intervalSet(this.invTime,(function(t){n.$tools.showToast(t)})),barcodeModel.continueScan(t,(function(t){n.$tools.showToast(t)}))},scanStartFunc:function(){var t=this;barcodeModel.scanStart((function(n){t.$tools.showToast(n)}))},hexiaoLuntan:function(t){var n=this;t=t.split("-");var e={exhId:this.exhInfo[1],unionid:t[0],userId:uni.getStorageSync("userInfo").userId,activityId:t[1]};2!=this.isLixian?(console.log("开始核销论坛",this.$paths.activitypda,e),this.$axios.axios("post",this.$paths.activitypda,e).then((function(e){console.log("论坛结果",e,200==e.code),200==e.code?(n.scanResult=t[0],n.$tools.showToast(t[0]+"论坛核销成功"),n.saveZhanhui(t[0],t[1],2,!0)):n.$tools.showToast(e.msg)})).catch((function(t){console.log("报错",t)}))):this.saveZhanhui(t[0],t[1],2,!1)},hexiao:function(t){var n=this,e={exhId:this.exhInfo[1],params:{unionid:t,userId:uni.getStorageSync("userInfo").userId,doorId:this.exhInfo[2]}};2!=this.isLixian?this.$axios.axios("post",this.$paths.visitpdaapi,e).then((function(e){console.log("和小爱",e),200==e.code?(n.$tools.showToast(t+"核销成功"),n.scanResult=t,n.saveZhanhui(t,"",1,!0)):n.$tools.showToast(e.msg)})).catch((function(t){console.log("报错了",t)})):this.saveZhanhui(t,"",1,!1)},getExhList:function(){var t=this,n={};console.log("获取展会列表",n,this.$paths.listexhpda),this.$axios.axios("post",this.$paths.listexhpda,n).then((function(n){console.log("展会列博鳌",n),200==n.code?(t.exhList=n.rows,uni.getStorageSync("zhanhuiInfo")&&uni.removeStorageSync("zhanhuiInfo")):t.$tools.showToast(n.msg)})).catch((function(t){}))},getMenList:function(){var t=this,n={exhId:uni.getStorageSync("zhanhuiInfo").id};console.log("获取大门列表",n,this.$paths.listmenpda),this.$axios.axios("post",this.$paths.listmenpda,n).then((function(n){200==n.code?t.menList=n.data:(t.menList=[],t.$tools.showToast(n.msg))})).catch((function(t){}))},exhChange:function(t){console.log(t),this.zhanhuiInfo=this.exhList[t.detail.value],uni.setStorageSync("zhanhuiInfo",this.zhanhuiInfo),uni.removeStorageSync("menType"),this.menType=null,this.getMenList()},menChange:function(t){this.menType=this.menList[t.detail.value],uni.setStorageSync("menType",this.menType)},toLogin:function(){wx.showModal({title:"提示",content:"确定要退出吗",success:function(t){t.confirm?uni.reLaunch({url:"/pages/login/login"}):t.cancel&&console.log("用户点击取消")}})},openSQL:function(){var t=this,n=i.default.isOpen();console.log("数据库状态",n?"开启":"关闭"),n?this.selectHexiaoNum():i.default.openSqlite().then((function(n){console.log("数据库已打开"),t.selectHexiaoNum()})).catch((function(t){console.log("数据库开启失败")}))},closeSQL:function(){var t=i.default.isOpen();t&&i.default.closeSqlite().then((function(t){console.log("数据库已关闭")})).catch((function(t){console.log("数据库关闭失败")}))},saveZhanhui:function(t,n,e,o){var s=this;console.log("离线保存",t,n,e);var a=uni.getStorageSync("userInfo"),c=uni.getStorageSync("exhInfo");if(!a)return this.$tools.showToast("请先登录"),!1;if(!c)return this.$tools.showToast("请先扫码获取展会信息"),!1;var u={loginPhone:a.phoneNum,loginName:a.staffName,exhId:c[1],activityId:n,doorId:c[2],unionid:t,userId:"",type:e,isLine:o,createTime:this.formatDate((new Date).getTime())};(1==this.isLixian||a&&a.userId)&&(u.userId=a.userId),u.isUpload=!1;this.formatDate((new Date).getTime());var l="'".concat(u.loginPhone,"','").concat(u.loginName,"','").concat(u.exhId,"','").concat(u.activityId,"','").concat(u.doorId,"','").concat(u.unionid,"','").concat(u.userId,"','").concat(u.type,"','").concat(u.isLine,"','").concat(u.isUpload,"','").concat(u.createTime,"'"),r="'loginPhone','loginName','exhId','activityId','doorId','unionid','userId','type','isLine','isUpload','createTime'";i.default.insertTableData("scan_info",l,r).then((function(n){console.log("新增数据成功"),s.updateHexiaoNum(),o||(s.scanResult=t,1==e?s.$tools.showToast(t+"入场离线核销成功"):2==e&&s.$tools.showToast(t+"论坛离线核销成功"))})).catch((function(t){console.log("失败",t)}))},selectHexiaoNum:function(){var t=this,n=this.formatDate1((new Date).getTime()),e=this.exhInfo,o=uni.getStorageSync("userInfo");i.default.selectTableData("statistics_num","exhId",e[1],"doorId",e[2],"loginPhone",o.phoneNum,"dayTime",n).then((function(n){if(console.log("查询成功",n),n.length>0){var e=n[0];e.count=parseInt(e.count),t.selResultCount=e}else t.$tools.showToast("查询失败")})).catch((function(t){}))},updateHexiaoNum:function(){var t=this,n=this.selResultCount;n.count=n.count+1;var e="count="+parseInt(n.count);this.selResultCount=n,i.default.updateTableData("statistics_num",e,"id",n.id).then((function(t){console.log("修改成功",t)})).catch((function(n){console.log("修改数量失败",n),t.$tools.showToast("修改数量失败")}))},showToast:function(t){uni.showToast({icon:"none",title:t,mask:!0})},formatDate:function(t){var n=new Date(t),e=n.getFullYear(),o=n.getMonth()+1<10?"0"+(n.getMonth()+1):n.getMonth()+1,i=n.getDate()<10?"0"+n.getDate():n.getDate(),s=n.getHours()<10?"0"+n.getHours():n.getHours(),a=n.getMinutes()<10?"0"+n.getMinutes():n.getMinutes(),c=n.getSeconds()<10?"0"+n.getSeconds():n.getSeconds();return e+"-"+o+"-"+i+" "+s+":"+a+":"+c},formatDate1:function(t){var n=new Date(t),e=n.getFullYear(),o=n.getMonth()+1<10?"0"+(n.getMonth()+1):n.getMonth()+1,i=n.getDate()<10?"0"+n.getDate():n.getDate();n.getHours(),n.getHours(),n.getMinutes(),n.getMinutes(),n.getSeconds(),n.getSeconds();return e+"-"+o+"-"+i}}};n.default=s},bc94:function(t,n,e){var o=e("24fb");n=o(!1),n.push([t.i,".btncen[data-v-776b95b4]{width:%?700?%;height:%?250?%;background-color:#2e7efc;line-height:%?350?%;text-align:center;color:#fff;border-radius:2%;color:#fff}.btncen1[data-v-776b95b4]{width:%?750?%}.content[data-v-776b95b4]{display:flex;flex-direction:column;align-items:center;justify-content:center}.logo[data-v-776b95b4]{height:%?200?%;width:%?200?%;margin-top:%?200?%;margin-left:auto;margin-right:auto;margin-bottom:%?50?%}.text-area[data-v-776b95b4]{display:flex;justify-content:center}.title[data-v-776b95b4]{font-size:%?36?%;color:#8f8f94}",""]),t.exports=n},deb0:function(t,n,e){var o=e("bc94");"string"===typeof o&&(o=[[t.i,o,""]]),o.locals&&(t.exports=o.locals);var i=e("4f06").default;i("67006662",o,!0,{sourceMap:!1,shadowMode:!1})},f5e1:function(t,n,e){e("99af"),e("d3b7"),t.exports={dbName:"zht",dbPath:"_downloads/zht.db",isOpen:function(){var t=plus.sqlite.isOpenDatabase({name:this.dbName,path:this.dbPath});return t},openSqlite:function(){var t=this;return new Promise((function(n,e){plus.sqlite.openDatabase({name:t.dbName,path:t.dbPath,success:function(t){n(t)},fail:function(t){e(t)}})}))},closeSqlite:function(){var t=this;return new Promise((function(n,e){plus.sqlite.closeDatabase({name:t.dbName,success:function(t){n(t)},fail:function(t){e(t)}})}))},createTable:function(t,n){var e=this;return new Promise((function(o,i){plus.sqlite.executeSql({name:e.dbName,sql:"CREATE TABLE IF NOT EXISTS ".concat(t,"(").concat(n,")"),success:function(t){o(t)},fail:function(t){i(t)}})}))},dropTable:function(t){var n=this;return new Promise((function(e,o){plus.sqlite.executeSql({name:n.dbName,sql:"DROP TABLE ".concat(t),success:function(t){e(t)},fail:function(t){o(t)}})}))},insertTableData:function(t,n,e){var o=this;if(void 0!==t&&void 0!==n){var i="{}"==JSON.stringify(n);if(i)return new Promise((function(t,n){n("错误添加")}));if(void 0==e)var s="INSERT INTO ".concat(t," VALUES('").concat(n,"')");else s="INSERT INTO ".concat(t," (").concat(e,") VALUES(").concat(n,")");return new Promise((function(t,n){plus.sqlite.executeSql({name:o.dbName,sql:s,success:function(n){t(n)},fail:function(t){n(t)}})}))}return new Promise((function(t,n){n("错误添加")}))},insertOrReplaceData:function(t,n,e){var o=this;if(void 0!==t&&void 0!==n){if(void 0==e)var i="INSERT OR REPLACE INTO ".concat(t," VALUES('").concat(n,"')");else i="INSERT OR REPLACE INTO ".concat(t," (").concat(e,") VALUES(").concat(n,")");return new Promise((function(t,n){plus.sqlite.executeSql({name:o.dbName,sql:i,success:function(n){t(n)},fail:function(t){n(t)}})}))}return new Promise((function(t,n){n("错误添加")}))},selectTableData:function(t,n,e,o,i,s,a,c,u){var l=this;if(void 0!==t){if(void 0!==n&&void 0!==o&&void 0!==s&&void 0!==c)var r="SELECT * FROM ".concat(t," WHERE ").concat(n," = '").concat(e,"' AND ").concat(o," = '").concat(i,"' AND ").concat(s,"='").concat(a,"' AND ").concat(c,"='").concat(u,"' ");else if(void 0!==n&&void 0!==o&&void 0!==s)r="SELECT * FROM ".concat(t," WHERE ").concat(n," = '").concat(e,"' AND ").concat(o," = '").concat(i,"' AND ").concat(s,"='").concat(a,"'");if(void 0!==n&&void 0!==o&&void 0==s)r="SELECT * FROM ".concat(t," WHERE ").concat(n," = '").concat(e,"' AND ").concat(o," = '").concat(i,"'");if(void 0!==n&&void 0==o&&void 0==s)r="SELECT * FROM ".concat(t," WHERE ").concat(n," = '").concat(e,"'");if(void 0==n)r="SELECT * FROM ".concat(t);return console.log("查询sql语句",r),new Promise((function(t,n){plus.sqlite.selectSql({name:l.dbName,sql:r,success:function(n){t(n)},fail:function(t){n(t)}})}))}return new Promise((function(t,n){n("错误查询")}))},selectTableData1:function(t,n){var e=this;if(void 0!==t){var o="SELECT * FROM "+t+" where isUpload='false' and  isLine='false'  LIMIT "+n;return console.log("查询sql语句",o),new Promise((function(t,n){plus.sqlite.selectSql({name:e.dbName,sql:o,success:function(n){t(n)},fail:function(t){n(t)}})}))}return new Promise((function(t,n){n("错误查询")}))},selectgetTotalCont:function(t){var n=this;if(void 0!==t){var e="select count(*) count FROM scan_info WHERE isUpload='false' and isLine='false'";return console.log("查询sql语句",e),new Promise((function(t,o){plus.sqlite.selectSql({name:n.dbName,sql:e,success:function(n){t(n)},fail:function(t){o(t)}})}))}return new Promise((function(t,n){n("错误查询")}))},deleteTableData:function(t,n,e,o,i){var s=this;if(void 0!==t){if(void 0==n)var a="DELETE FROM ".concat(t);else if(void 0!==o)a="DELETE FROM ".concat(t," WHERE ").concat(n," = '").concat(e,"' AND ").concat(o," = '").concat(i,"'");else a="DELETE FROM ".concat(t," WHERE ").concat(n," = '").concat(e,"'");return new Promise((function(t,n){plus.sqlite.executeSql({name:s.dbName,sql:a,success:function(n){t(n)},fail:function(t){n(t)}})}))}return new Promise((function(t,n){n("错误删除")}))},updateTableData:function(t,n,e,o){var i=this;if(void 0==e)var s="UPDATE ".concat(t," SET ").concat(n);else s="UPDATE ".concat(t," SET ").concat(n," WHERE ").concat(e," = '").concat(o,"'");return new Promise((function(t,n){plus.sqlite.executeSql({name:i.dbName,sql:s,success:function(n){t(n)},fail:function(t){n(t)}})}))},pullSQL:function(t,n,e){var o=this;return new Promise((function(i,s){plus.sqlite.selectSql({name:o.dbName,sql:"SELECT * FROM ".concat(t," ORDER BY '").concat(n,"' DESC LIMIT 15 OFFSET '").concat(e,"'"),success:function(t){i(t)},fail:function(t){s(t)}})}))},selWuxiaoNum:function(){var t=this;return new Promise((function(n,e){plus.sqlite.selectSql({name:t.dbName,sql:'SELECT count(*) count FROM scan_info WHERE isLine="false" AND isUpload="no"',success:function(t){n(t)},fail:function(t){e(t)}})}))},delWuxiaodata:function(){var t=this;return new Promise((function(n,e){plus.sqlite.selectSql({name:t.dbName,sql:"DELETE FROM scan_info WHERE isUpload ='no'",success:function(t){n(t)},fail:function(t){e(t)}})}))}}},f776:function(t,n,e){"use strict";e.r(n);var o=e("b627"),i=e.n(o);for(var s in o)"default"!==s&&function(t){e.d(n,t,(function(){return o[t]}))}(s);n["default"]=i.a}}]);